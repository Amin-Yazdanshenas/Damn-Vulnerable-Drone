{% extends "pages/index.html" %}
<!-- Main page content-->
{% block content %}
<div id="modalLoader" class="modal">
    <div class="modal-content">
        <div class="loader"></div>
        <p>Loading...</p>
    </div>
</div>
<main>
    <iframe id="sim-iframe" src="http://localhost:8080" style="width: 100%; height: 100vh;"></iframe>
</main>
<script>
window.addEventListener("message", (event) => {
    // Check the origin of the message for security
    if (event.origin !== "http://localhost:8080") {
        return; // Not from the expected origin, ignore it
    }
    console.log(event.data)
    // Handle the message

    if (event.data === "resetWorldClicked") {
        Swal.fire({
            title: "Reset Simulator?",
            text: "This will return the drone flight controller, companion computer, and ground station to their initial state!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: '#d33',
            confirmButtonText: "Yes, reset it!"
        }).then((result) => {
            if (result.isConfirmed) {
                // Reset Flight Controller
                // Reset Companion Computer
                // Reset GCS
                // Reset Simulator
                var iframeWindow = document.getElementById("sim-iframe").contentWindow;
                iframeWindow.postMessage("resetWorldCallback", "http://localhost:8080");
                document.getElementById("sim-iframe").src = document.getElementById("sim-iframe").src;

                // You may want to close the Swal here or do something else
            }
        });
    }
});
</script>
{% endblock %}
